<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'main.css' %}">
    <title>Kosupure</title>
</head>

<body>
{% csrf_token %}
{% if user.is_authenticated %}
    <header>
        <h1>Welcome to Kosupure, {{ user.username }}! <span><a href="{% url 'logout' %}" class="logout">Logout ?</a></span></h1>
        <h2><a href="{% url 'home' %}">Kosupure Posts</a></h2>
        <h2><a href="{% url 'events' %}">Events</a></h2>
        <hr class="tophr">
    </header>
{% else %}
    <header2>
        <h1>Welcome to Kosupure, visitor!</h1>
        <h2>You are not logged in. <a href="{% url 'login' %}" class="logout">Login</a> <a href="{% url 'users:signup' %}" class="logout">Sign Up</a></h2>
        <h2><a href="{% url 'home' %}">Kosupure Posts</a></h2>
        <h2><a href="{% url 'events' %}">Events</a></h2>
    </header2>
{% endif %}

<div id="game">
    <div class="imageContainer">
        <h1>Who told you asteroids were flying by the Earth?</h1> 
            <a href="#" @click="selection='thanos'; checkDate(); loadNASA(); isHidden = false"><img :src="thanos" class="images" @mouseover="thanosActive = true" @mouseleave="thanosActive = false"></a>
            <a href="#" @click="selection='morgan'; checkDate(); loadNASA(); isHidden = false"><img :src="morgan" class="images" @mouseover="morganActive = true" @mouseleave="morganActive = false"></a>
            <a href="#" @click="selection='mayan'; checkDate(); loadNASA(); isHidden = false"><img :src="mayan" class="images" @mouseover="mayanActive = true" @mouseleave="mayanActive = false"></a>
            <a href="#" @click="selection='camping'; checkDate(); loadNASA(); isHidden = false"><img :src="camping" class="images" @mouseover="campingActive = true" @mouseleave="campingActive = false"></a>
            <a href="#" @click="selection='apophis'; checkDate(); loadNASA(); isHidden = false"><img :src="tyson" class="images" @mouseover="tysonActive = true" @mouseleave="tysonActive = false"></a>
            <br>
        </div>
        <div v-show="thanosActive">
            <h2>"What I'm About To Do To Your Stubborn, Annoying Little Planet, I'm Gonna Enjoy It, Very, Very Much."</h2>
        </div>
        <div v-show="morganActive">
            <h2>We watched as the bombs shattered the second comet into a million pieces of ice and rock that 
            burned harmlessly in our atmosphere and lit up the sky for an hour. Still, we were left with the devastation of the first. The waters reached as far inland as the Ohio and Tennessee Valleys. It washed away farms and towns, forests and skyscrapers. But, the water receded. The wave hit Europe and Africa too. Millions were lost, and countless more left homeless. But the waters receded. Cities fall, but they are rebuilt. And heroes die, but they are remembered. We honor them with every brick we lay, with every field we sow, With every child we comfort, and then teach to rejoice in what we have been re-given. Our planet. Our home. So now, let us begin.</h2>
        </div>
        <div v-show="mayanActive">
            <h2>Forecasting Armageddon has become trendy of late, with a great deal of attention being given to 
            an interpretation of the Mayan Calendar suggesting that Mother Earth is destined for doom in 
            December of 2012. - Author: Seth Shostak</h2>
        </div>
        <div v-show="campingActive">
            <h2>‚ÄúAnd now, we have no option. We can't say 'maybe' 'it's possible' 'it looks very probable...' 
            No way! We have to say this is what the Bible teaches! This is fact! May 21, 2011 is the day of the 
            Rapture, it is the day that Judgment Day begins...‚Äù ‚Äï Harold Camping</h2>
        </div>
        <div v-show="tysonActive">
            <h2>‚ÄúOn Friday the 13th, April 2029, an asteroid large enough to fill the Rose Bowl as though it were an egg cup will fly so close to Earth that it will dip below the altitude of our communication satellites. We did not name this asteroid Bambi. Instead, we named it Apophis, after the Egyptian god of darkness and death.‚Äù - Neil DeGrasse Tyson</h2>
        </div>
        <br>
        <hr>
        <br>
            <p>Enter a date and use my NASA ID to check for danger:</p>
        <input v-model="inputDate" id="inputDate" type="date"> 
        <br><br>
        <button @click="loadNASA(), isHidden = false" id="send">Tell me about this day!</button>
        <br>
        
        <br>
        <p v-if="!isHidden">
            According to NASA, a [[ sizeMeters ]] meter asteroid traveling at [[ mph ]] mph named [[ name ]]
            <br> 
            has a nearest distance of [[lunar]] lunar units from the Earth on [[ date ]]
            <br>
            Aproximate nearest distance: [[ missDistance - 240000 ]] miles further away than our moon.
            <br>
            The moon is approximately 240,000 miles away from the Earth
        <hr>
        </p>
        <div class="potd">
            <button @click="toggleImage(), loadPotd()" class='gloombutton'>Too much Doom and Gloom? Picture of The Day Button Right Here!</button>
            <h2 v-if='showImage'>
                <img :src="potd" onclick="window.open(this.src, '_blank')" class="potdimage">
            <br>
            [[ title ]]
            <br>
            [[ explanation ]]</h2>
        </div>
        <hr>
        <div>
            <h1 @mouseover="active = true" @mouseleave="active = false" class='elon'>Batman Says:</h1>
            <div v-show="active">
                <h1>‚ÄúMaybe That's What Batman Is About. Not Winning. But Failing, And Getting Back Up. Knowing He'll Fail, Fail A Thousand Times, But Still Won't Give Up.‚Äù</h1>
            </div>
        </div>
        <br><br>
        <div id="bag" :class="{ bag: hundred, burst1: ninety, burst2: eighty, burst3: seventy, burst4: sixty, burst5: fifty, 
        burst6: forty, burst7: thirty, burst8: twenty, burst9: ten, burst: ended }"></div>
        <div id="bag-health">
            <div :style="{ width: health + '%' }"></div>
        </div>
        <div id="controls">
            <button  @click.prevent="fire(), playSound(missileaudio)" v-if="resources.missile.count > 0" v-show="!ended">Fire Missile</button>
        </div>
        <section>
            <h2> Finance an effort to destroy the incoming asteroid! </h2>
            <p>Hint: Click the money bag</p>
                    <button @click="money++">üí∞</button>
                    <div>
                        Money: [[ Math.floor(money) ]]
                        [[ displayMissiles ]]
                    </div>

                    <div v-for="(resources, id) in resources">
                        [[ resources.count ]]x [[ resources.icon ]]: [[ resources.cost ]]
                        <button @click="buy(id)"
                            v-if="money >= resources.cost">
                            Finance Lobbyist for [[ id ]]: üí∞[[ resources.cost ]]
                        </button>
                    </div>
            </section>
    </div>
</main>
</center>

</div>
<script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/gsap-latest-beta.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>


    const app = new Vue({
        el: "#game",
        delimiters: ['[[', ']]'],
        data: {
            active: false,
            apophis: '{% static "images/apophis.jpg" %}',
            asteroid: '',
            asteroidName: '',
            camping: '{% static "images/camping.jpg" %}',
            campingActive: false,
            deep: '{% static "images/deep.jpg" %}',
            date: '',
            designation: '',
            eighty: false,
            ended: false,
            explanation: '',
            fifty: false,
            forty: false,
            health: 100,
            hundred: false,
            inputDate: new Date().toISOString().slice(0,10),
            isHidden: true,
            lookUpSize: '',
            lookUpDate: '',
            lookUpDistance: '',
            lookUpSpeed: '',
            lunar: '',
            mph: '',
            mayan: '{% static "images/mayan.jpg" %}',
            mayanActive: false,
            missDistance: '',
            missileaudio: '{% static "images/missile.mp3" %}',
            morgan: '{% static "images/morgan.jpg" %}',
            morganActive: false,
            name: '',
            ninety: false,
            potd: '',
            selection: '',
            seventy: false,
            showImage: false,
            sixty: false,
            sizeMeters: '',
            sizeMiles: '',
            ten: false,
            thanos: '{% static "images/thanos.jpg" %}',
            thanosActive: false,
            thirty: false,
            title: '',
            twenty: false,
            tyson: '{% static "images/tyson.jpg" %}',
            tysonActive: false,
            money: 0,
            resources: {
                Crowdsourcing: {
                    icon: "üßë‚Äçü§ù‚Äçüßë",
                    cost: 5,
                    rate: 3,
                    count: 0
                },
                TaxHike: {
                    icon: "üí∏",
                    cost: 10,
                    rate: 15,
                    count: 0
                },
                Mob: {
                    icon: "üî•",
                    cost: 100,
                    rate: 30,
                    count: 0
                },
                missile: {
                    icon: "üöÄ",
                    cost: 1000,
                    rate: 400.9,
                    count: 0
                }
            }
        },
    
        methods: {
            loadNASA: function () {
                axios({
                    method: 'GET',
                    url: `https://api.nasa.gov/neo/rest/v1/feed?start_date=${this.inputDate}`,
                    params: {
                        api_key: `x9tOqUPDJm12DiV8OLgtWCHTmUplEo2jisd1IVK0`
                    }
                }).then(response => {
                    this.inputDate = document.getElementById('inputDate').value.toString()
                    this.day = response.data.near_earth_objects[this.inputDate]
                    this.mph = Math.round(this.day[0]['close_approach_data'][0]["relative_velocity"]["miles_per_hour"])
                    this.lunar = Math.round(this.day[0]['close_approach_data'][0]['miss_distance']['lunar'])
                    this.missDistance = Math.round(this.day[0]['close_approach_data'][0]['miss_distance']['miles'])
                    this.date = this.day[0]['close_approach_data'][0]['close_approach_date']
                    this.name = this.day[0]['name']
                    this.sizeMeters = Math.round(this.day[0]['estimated_diameter']['meters']['estimated_diameter_max'])
                    this.sizeMiles = Math.round(this.day[0]['estimated_diameter']['miles']['estimated_diameter_max'])
                })
            },
            loadAsteroid: function () {
                axios({
                    method: 'GET',
                    url: `https://api.nasa.gov/neo/rest/v1/neo/${this.asteroid}`,
                    params: {
                        api_key: `x9tOqUPDJm12DiV8OLgtWCHTmUplEo2jisd1IVK0`
                    }
                }).then(response => {
                    this.asteroid = document.getElementById('asteroid').value.toString()
                    this.designation = response.data['designation']
                    this.lookUpSize = Math.round(response.data.estimated_diameter['meters']['estimated_diameter_max'])
                    this.lookUpDate = response.data['close_approach_data'][0]['close_approach_date']
                    this.lookUpDistance = Math.round(response.data['close_approach_data'][0]['miss_distance']['lunar'])
                    this.lookUpSpeed = Math.round(response.data['close_approach_data'][0]["relative_velocity"]["miles_per_hour"])
                })
            },
            checkDate: function() {
                if (this.selection === "thanos") {
                    this.inputDate = "2018-04-25"
                }
                else if (this.selection === "morgan") {
                    this.inputDate = "1998-05-08"
                }
                else if (this.selection === "mayan") {
                    this.inputDate = "2012-12-21"
                }
                else if (this.selection === "camping") {
                    this.inputDate = "2021-05-21"
                }
                else if (this.selection === "apophis") {
                    this.inputDate = "2029-04-13"
                }
            },
            loadPotd: function() {
                axios({
                    method: 'GET',
                    url: `https://api.nasa.gov/planetary/apod?`,
                    params: {
                        api_key: `x9tOqUPDJm12DiV8OLgtWCHTmUplEo2jisd1IVK0`
                    }
                }).then(response => {
                    this.potd = response.data["url"]
                    console.log(this.potd)
                    this.explanation = response.data["explanation"]
                    this.title = response.data["title"]
                })
            },
            toggleImage: function() {
                this.showImage = !this.showImage
            },
            fire: function() {
                this.health -= 10
                this.resources.missile.count -= 1
                if ( this.health == 100 ) {
                    this.hundred = true
                }
                if ( this.health == 90 ) {
                    this.ninety = true
                }
                if ( this.health == 80 ) {
                    this.eighty = true
                }
                if ( this.health == 70 ) {
                    this.seventy = true
                }
                if ( this.health == 60 ) {
                    this.sixty = true
                }
                if ( this.health == 50 ) {
                    this.fifty = true
                }
                if ( this.health == 40 ) {
                    this.forty = true
                }
                if ( this.health == 30 ) {
                    this.thirty = true
                }
                if ( this.health == 20 ) {
                    this.twenty = true
                }
                if ( this.health == 10 ) {
                    this.ten = true
                }
                if ( this.health <= 0 ) {
                    this.ended = true
                }
            },
            restart: function() {
                this.health = 100
                this.ended = false
            },
            buy: function(id) {
                this.resources[id].count++
                this.money -= this.resources[id].cost
                let inflation = 1.1
                this.resources[id].cost = Math.floor(this.resources[id].cost * inflation)
            },
            playSound (sound) {
                if(sound) {
                    var audio = new Audio(sound);
                    audio.play();
                }
            }
        },
        mounted: function() {
            let loopCount = 0
            setInterval(() => {
                loopCount++
                let keys = Object.keys(this.resources)
                for (index in keys) {
                    let key = keys[index]
                    this.money += this.resources[key].rate * this.resources[key].count
                }
            }, 100)
        },
        computed: {
            displayMissiles: function() {
                let m = ""
                for (var i = 0; i < this.resources.missile.count; i++) {
                    m += "üöÄ"
                }
                return m
            }
        }
    })
    

</script>
</body>